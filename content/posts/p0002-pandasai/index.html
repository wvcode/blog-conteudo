<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Walter R. Paixão-Côrtes">
<meta name="dcterms.date" content="2023-05-24">
<meta name="description" content="Nova biblioteca se propõe a permitir que você “converse” com o seu DataFrame.">

<title>WVCode - Educação e Consultoria - Pandas AI - Converse com seu DataFrame</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../../library/bars/bar_002_code.jpg);
background-size: cover;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../library/logos/logo_000_wvcode.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">WVCode - Educação e Consultoria</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Sobre</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/wvcode" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Pandas AI - Converse com seu DataFrame</h1>
                  <div>
        <div class="description">
          Nova biblioteca se propõe a permitir que você “converse” com o seu DataFrame.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Ciência de Dados</div>
                <div class="quarto-category">Pandas</div>
                <div class="quarto-category">AI</div>
                <div class="quarto-category">GPT</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Walter R. Paixão-Côrtes </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 24, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução">Introdução</a></li>
  <li><a href="#e-o-que-isso-tem-a-ver-com-ciências-de-dados" id="toc-e-o-que-isso-tem-a-ver-com-ciências-de-dados" class="nav-link" data-scroll-target="#e-o-que-isso-tem-a-ver-com-ciências-de-dados">E o que isso tem a ver com Ciências de Dados?</a></li>
  <li><a href="#o-que-é-o-pandas-ai" id="toc-o-que-é-o-pandas-ai" class="nav-link" data-scroll-target="#o-que-é-o-pandas-ai">O que é o Pandas AI?</a>
  <ul class="collapse">
  <li><a href="#preparando-o-ambiente" id="toc-preparando-o-ambiente" class="nav-link" data-scroll-target="#preparando-o-ambiente">Preparando o Ambiente</a></li>
  </ul></li>
  <li><a href="#vamos-complicar-um-pouco" id="toc-vamos-complicar-um-pouco" class="nav-link" data-scroll-target="#vamos-complicar-um-pouco">Vamos complicar um pouco?</a></li>
  <li><a href="#usando-outras-funcionalidades-do-pandas-via-conversação" id="toc-usando-outras-funcionalidades-do-pandas-via-conversação" class="nav-link" data-scroll-target="#usando-outras-funcionalidades-do-pandas-via-conversação">Usando outras funcionalidades do Pandas via conversação</a></li>
  <li><a href="#o-que-aprendemos-até-aqui" id="toc-o-que-aprendemos-até-aqui" class="nav-link" data-scroll-target="#o-que-aprendemos-até-aqui">O que aprendemos até aqui</a>
  <ul class="collapse">
  <li><a href="#mas-nem-tudo-são-flores" id="toc-mas-nem-tudo-são-flores" class="nav-link" data-scroll-target="#mas-nem-tudo-são-flores">Mas nem tudo são flores…</a></li>
  </ul></li>
  <li><a href="#vale-a-pena-utilizar" id="toc-vale-a-pena-utilizar" class="nav-link" data-scroll-target="#vale-a-pena-utilizar">Vale a pena utilizar?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introdução" class="level2">
<h2 class="anchored" data-anchor-id="introdução">Introdução</h2>
<p>Desde outubro do ano passado, com a liberação do ChatGPT 3.5, as interfaces conversacionais vem se popularizando de maneira muito rápida. É verdade que interfaces conversacionais não são novidade, e chatbots e assistentes virtuais vem dominando tarefas relacionadas a atendimento de clientes, mas desde o advento do ChatGPT, tem-se expandido para outras áreas de atuação.</p>
<p>Utilizamos o ChatGPT para criarmos resumos de textos longos, para consultar algo que ocorreu no passado, explicar conceitos e por aí vai. Já existem cursos que ensinam como utilizar o ChatGPT para criar campanhas de marketing nas redes sociais e outras tantas funções que são basicamente apoiadas em texto.</p>
<p>Dentro da programação, é possível gerar pequenos trechos de código e até páginas HTML e arquivos CSS inteiros.</p>
</section>
<section id="e-o-que-isso-tem-a-ver-com-ciências-de-dados" class="level2">
<h2 class="anchored" data-anchor-id="e-o-que-isso-tem-a-ver-com-ciências-de-dados">E o que isso tem a ver com Ciências de Dados?</h2>
<p>Os DataFrames são basicamente textos organizados em tabelas e colunas, que são correlacionados. Portanto, é possível carregar os dados em um modelo LLM (Large Language Model), habilitando a extração da informação destes DataFrames de maneira conversacional, como se estivéssemos dialogando. Mas o que realmente instiga esta nossa área é descobrir se podemos fazer este modelo realizar o trabalho de análise para nós, cientistas e analistas iniciantes (e até mesmo os mais experientes). A resposta mais recente que temos para isso é chamada de <code>Pandas AI</code>.</p>
</section>
<section id="o-que-é-o-pandas-ai" class="level2">
<h2 class="anchored" data-anchor-id="o-que-é-o-pandas-ai">O que é o Pandas AI?</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pandas-llamas.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Pandas e Llamas</figcaption>
</figure>
</div>
<p>O Pandas AI é o melhor amigo do seu DataFrame! Com esta nova biblioteca, podemos dar aos nossos DataFrames a capacidade de serem consultados de maneira simples e eficiente, utilizando uma interface conversacional.</p>
<p>Então, vamos ver como podemos utilizar Pandas AI?</p>
<section id="preparando-o-ambiente" class="level3">
<h3 class="anchored" data-anchor-id="preparando-o-ambiente">Preparando o Ambiente</h3>
<p>A primeira coisa é garantir que seu ambiente tenha todas as bibliotecas necessárias instaladas: <code>Pandas</code>, <code>PandasAI</code>, <code>OpenAI</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pip install pandas pandasai openai</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Então, vamos iniciar o nosso notebook. Temos que fazer o import das bibliotecas que vamos utilizar na nossa demonstração.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandasai <span class="im">import</span> PandasAI</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandasai.llm.openai <span class="im">import</span> OpenAI</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observe que carregamos a função <code>load_dotenv</code>, pois iremos precisar carregar a chave de acesso para a API da OpenAI. Para fazer isso, podemos simplesmente executar a função.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>True</code></pre>
</div>
</div>
<p>O próximo passo é carregar os nossos dados no DataFrame. Como sempre, vamos utilizar o dataset de pokemons.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pokemons <span class="op">=</span> pd.read_csv(<span class="st">'pokemons.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Em seguida, vamos inicializar o LLM para que consigamos conversar com o nosso DataFrame.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>llm <span class="op">=</span> OpenAI(api_token<span class="op">=</span>os.environ[<span class="st">'OPENAI_API_KEY'</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pandas_ai <span class="op">=</span> PandasAI(llm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Até agora, tudo correu bem! Agora, podemos executar diversas vezes a função <code>pandas_ai.run</code>, passando nosso DataFrame e um prompt, e ele nos responderá. Vamos testar?</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Quantos pokemons temos no DataFrame?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>'Unfortunately, I was not able to answer your question. Please try again. If the problem persists, try rephrasing your question.'</code></pre>
</div>
</div>
<p>Para verificar isso, podemos apenas ver o shape do DataFrame e confirmar:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pokemons.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>(1032, 44)</code></pre>
</div>
</div>
<p>De fato, 1032 pokemons. Vamos continuar?</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Quantos tipos de pokemons existem?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>'Well, there are actually 18 different types of pokemons out there!'</code></pre>
</div>
</div>
<p>Vamos conferir?</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tipos <span class="op">=</span> pd.concat([pokemons[<span class="st">'Type 1'</span>], pokemons[<span class="st">'Type 2'</span>]]).unique().tolist()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(tipos))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tipos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19
['Grass', 'Fire', 'Water', 'Bug', 'Normal', 'Dark', 'Poison', 'Electric', 'Ground', 'Ice', 'Fairy', 'Steel', 'Fighting', 'Psychic', 'Rock', 'Ghost', 'Dragon', 'Flying', nan]</code></pre>
</div>
</div>
<p>Parece que funciona mesmo! Note que o nosso vetor tem 19 posições porque está contando o nulo como um valor. Vamos nos aprofundar mais um pouco…</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">'Liste os tipos com as quantidades de pokemons'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>'Existem diversos tipos de pokemons e suas quantidades variam. O tipo mais comum é o Normal, com 114 pokemons, seguido pelo tipo Água, com 131. Já o tipo Voador é o menos comum, com apenas 8 pokemons. Além disso, existem outros tipos como Fogo, Grama, Elétrico, Psíquico, entre outros, cada um com sua quantidade específica de pokemons. No total, existem mais de 800 espécies diferentes de pokemons.'</code></pre>
</div>
</div>
<p>Ele respondeu, mas não exatamente como queríamos - observe que ele listou alguns tipos apenas com suas quantidades. Vamos tentar melhorar, aplicando um pouco de prompt engineering (ou seja, escrever nossa solicitação de forma mais explícita).</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Crie uma tabela que tem duas colunas: tipo de pokemon e quantidade. Liste todos os tipos possíveis e suas quantidades."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>'Para responder à pergunta, criei uma tabela com duas colunas: tipo de pokemon e quantidade. Nessa tabela, listei todos os tipos possíveis de pokemon e suas respectivas quantidades. Por exemplo, há 81 pokemons do tipo Bug, 46 do tipo Dark, 42 do tipo Dragon, e assim por diante. No total, foram listados 18 tipos diferentes de pokemon e suas quantidades correspondentes.'</code></pre>
</div>
</div>
<p>Humm, ainda não conseguimos listar todos os tipos. Vamos explicar um pouco mais?</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Gerar uma listagem completa da quantidade de pokemons por tipo, em formato markdown."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>'Para saber a quantidade de pokemons por tipo, podemos gerar uma listagem completa em formato markdown. Aqui está a tabela com o número de pokemons para cada tipo: \n\n| Type | Count |\n|------|-------|\n| Bug | 81 |\n| Dark | 46 |\n| Dragon | 42 |\n| Electric | 59 |\n| Fairy | 22 |\n| Fighting | 42 |\n| Fire | 64 |\n| Flying | 8 |\n| Ghost | 41 |\n| Grass | 91 |\n| Ground | 41 |\n| Ice | 38 |\n| Normal | 114 |\n| Poison | 40 |\n| Psychic | 77 |\n| Rock | 59 |\n| Steel | 36 |\n| Water | 131 |\n\nAssim, você pode ter uma visão geral da distribuição dos tipos de pokemons na lista.'</code></pre>
</div>
</div>
<p>Opa,agora foi. Mas como o notebook não formata markdown no output, precisamos fazer um copia e cola do resultado.</p>
<p>Para saber a quantidade de pokemons por tipo, podemos gerar uma listagem completa em formato markdown. Aqui está a tabela com o número de pokemons para cada tipo:</p>
<table class="table">
<thead>
<tr class="header">
<th>Type</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bug</td>
<td>81</td>
</tr>
<tr class="even">
<td>Dark</td>
<td>46</td>
</tr>
<tr class="odd">
<td>Dragon</td>
<td>42</td>
</tr>
<tr class="even">
<td>Electric</td>
<td>59</td>
</tr>
<tr class="odd">
<td>Fairy</td>
<td>22</td>
</tr>
<tr class="even">
<td>Fighting</td>
<td>42</td>
</tr>
<tr class="odd">
<td>Fire</td>
<td>64</td>
</tr>
<tr class="even">
<td>Flying</td>
<td>8</td>
</tr>
<tr class="odd">
<td>Ghost</td>
<td>41</td>
</tr>
<tr class="even">
<td>Grass</td>
<td>91</td>
</tr>
<tr class="odd">
<td>Ground</td>
<td>41</td>
</tr>
<tr class="even">
<td>Ice</td>
<td>38</td>
</tr>
<tr class="odd">
<td>Normal</td>
<td>114</td>
</tr>
<tr class="even">
<td>Poison</td>
<td>40</td>
</tr>
<tr class="odd">
<td>Psychic</td>
<td>77</td>
</tr>
<tr class="even">
<td>Rock</td>
<td>59</td>
</tr>
<tr class="odd">
<td>Steel</td>
<td>36</td>
</tr>
<tr class="even">
<td>Water</td>
<td>131</td>
</tr>
</tbody>
</table>
<p>Assim, você pode ter uma visão geral da distribuição dos tipos de pokemons na lista.’</p>
</section>
</section>
<section id="vamos-complicar-um-pouco" class="level2">
<h2 class="anchored" data-anchor-id="vamos-complicar-um-pouco">Vamos complicar um pouco?</h2>
<p>Nas primeiras perguntas, utilizamos perguntas que pedem respostas quase que diretas das métricas que temos no DataFrame. Contamos o número de pokemons, contamos valores distinto de tipos, agrupamos a contagem por tipos. Mas será que o Pandas AI pode fazer uma análise comparativa simples, tal como analisar uma métrica e retornar o insight solicitado?</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Qual o pokemon mais pesado?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>'Bem, o pokemon mais pesado é o Snorlax, ele pode chegar a pesar mais de 460 quilos!'</code></pre>
</div>
</div>
<p>Opa, e não é que respondeu? Mas, sem precipitação, vamos conferir: vamos executar uma query em pandas que filtra os pokemons com peso &gt;= ao do Snorlax.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pokemons[[<span class="st">"Name"</span>,<span class="st">"Weight"</span>]].sort_values(<span class="st">"Weight"</span>).query(<span class="st">"Weight &gt; 459"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">925</td>
<td>Dusk Mane Necrozma</td>
<td>460.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">181</td>
<td>Snorlax</td>
<td>460.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">837</td>
<td>Hoopa Unbound</td>
<td>490.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">826</td>
<td>Avalugg</td>
<td>505.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1001</td>
<td>Stonjourner</td>
<td>520.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">445</td>
<td>Metagross</td>
<td>550.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">833</td>
<td>Zygarde Complete</td>
<td>610.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">578</td>
<td>Giratina-Origin</td>
<td>650.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1007</td>
<td>Copperajah</td>
<td>650.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">573</td>
<td>Dialga</td>
<td>683.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">254</td>
<td>Mega Steelix</td>
<td>740.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">577</td>
<td>Giratina</td>
<td>750.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1019</td>
<td>Zamazenta Crowned Shield</td>
<td>785.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1027</td>
<td>Glastrier</td>
<td>800.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">936</td>
<td>Melmetal</td>
<td>800.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1030</td>
<td>Calyrex Ice Rider</td>
<td>809.1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">932</td>
<td>Stakataka</td>
<td>820.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">923</td>
<td>Guzzlord</td>
<td>888.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">873</td>
<td>Mudsdale</td>
<td>920.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">446</td>
<td>Mega Metagross</td>
<td>942.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1020</td>
<td>Eternatus</td>
<td>950.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">456</td>
<td>Groudon</td>
<td>950.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">457</td>
<td>Primal Groudon</td>
<td>999.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">914</td>
<td>Cosmoem</td>
<td>999.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">921</td>
<td>Celesteela</td>
<td>999.9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Ops, algo deu errado. Temos vários pokemons mais pesados. Será que ele não analisou todos os pokemons antes de responder? Quem sabe um problema nos dados? Vamos perguntar algo mais direto.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"O pokemon Dialga é mais ou menos pesado que o Snorlax?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>'Well, it turns out that Snorlax is actually heavier than Dialga.'</code></pre>
</div>
</div>
<p>Isso certamente deve ser um problema. Ele passou a responder em inglês, como se tivesse perdido o contexto. Vamos perguntar de maneira diferente…</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Porque o pokemon Dialga é mais pesado que o Snorlax?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>'Well, actually, Snorlax weighs more than Dialga.'</code></pre>
</div>
</div>
<p>É, ele realmente tem uma implicância com o Snorlax… Caso você não tenha lido nada a respeito do ChatGPT e LLMs em geral, esse tipo de erro é chamado de “alucinação” que ocorre quando o modelo produz resultados incorretos, correlacionando informações de maneira espúria.</p>
</section>
<section id="usando-outras-funcionalidades-do-pandas-via-conversação" class="level2">
<h2 class="anchored" data-anchor-id="usando-outras-funcionalidades-do-pandas-via-conversação">Usando outras funcionalidades do Pandas via conversação</h2>
<p>Agora vamos testar se o pandasAI consegue entender instruções para plotar gráficos. Isso é um DataFrame pandas, correto? Será que eu posso plotar um countplot() por geração?</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Plote um gráfico de colunas totalizando pokemons por geração."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>'Claro! Vou plotar um gráfico de colunas que mostra a quantidade total de pokemons por geração.'</code></pre>
</div>
</div>
<p>Parece que funcionou bem! Vamos tentar mais um?</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pandas_ai.run(pokemons, prompt<span class="op">=</span><span class="st">"Plote um gráfico de pizza totalizando pokemons pelo campo lendário."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>'Sure, I can help you with that! To plot a pie chart showing the total number of legendary Pokémon, we need to gather the data first. Once we have the numbers, we can create a visual representation of the data using a pie chart. Would you like me to proceed with the task?'</code></pre>
</div>
</div>
</section>
<section id="o-que-aprendemos-até-aqui" class="level2">
<h2 class="anchored" data-anchor-id="o-que-aprendemos-até-aqui">O que aprendemos até aqui</h2>
<p>A biblioteca Pandas AI é uma biblioteca interessante, que nos permite “dialogar”com nossos DataFrames, extraindo informações do mesmo. Através de nossos exemplos, podemos verificar que quase tudo que podemos descobrir através de consultas normais pandas, podemos perguntar ao DataFrame através do Pandas AI.</p>
<section id="mas-nem-tudo-são-flores" class="level3">
<h3 class="anchored" data-anchor-id="mas-nem-tudo-são-flores">Mas nem tudo são flores…</h3>
<p>Apesar dos acertos, observamos que a biblioteca Pandas AI não é imune aos problemas comuns das LLM, e mesmo com uma base de conhecimento mais limitada, é acometida de alucinações. A biblioteca também sofre de um problema de performance: uma resposta que em pandas leva um segundo ou menos para ser mostrada, como podemos ver, pode levar até mais de 1 minuto usando PandasAI.</p>
<p>Por último, podemos perceber que a biblioteca ainda precisa um pouco mais de trabalho até mesmo em sua usabilidade - notamos que a mesma passa a responder em inglês quando a resposta está errada, deixando o usuário confuso.</p>
</section>
</section>
<section id="vale-a-pena-utilizar" class="level2">
<h2 class="anchored" data-anchor-id="vale-a-pena-utilizar">Vale a pena utilizar?</h2>
<p>Se você quer fazer explorações simples dos dados, parece ser uma boa idéia utilizar o PandasAI, visto que é mais fácil perguntar em português ou inglês do que lembrar a sintaxe de todos os comandos Pandas que você teria que fazer para isso. No entanto, é preciso tomar muito cuidado com os resultados, que podem estar errados, mas são comunicados com convicção.</p>
<p>É, com certeza, mais uma ferramenta no seu cinto de utilidades de cientista de dados, e como toda ferramenta, devemos conhece-la bem antes de usar. Explore mais, entenda suas limitações e faça o melhor uso possivel!</p>
<p>Até mais!!!</p>
<p>Walter.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>